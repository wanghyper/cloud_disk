(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["home"],{"0116":function(e,t,i){},"02c1":function(e,t,i){},"084e":function(e,t,i){"use strict";var s=i("0116"),n=i.n(s);n.a},"5f7c":function(e,t,i){},"63e9":function(e,t,i){},"92df":function(e,t,i){"use strict";var s=i("5f7c"),n=i.n(s);n.a},bb51:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"home"},[i("TopBar"),i("LeftBar",{attrs:{currIndex:0}}),i("Content")],1)},n=[],a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"top"},[i("div",{staticClass:"name"},[e._v("我的云盘")]),e._m(0),i("div",{staticClass:"user"},[i("span",{staticClass:"username"},[i("i",{staticClass:"icon-user"}),e._v("\n      "+e._s(e.$store.state.userInfo.user_name)+"\n    ")]),e._v("\n     \n    "),i("span",{staticClass:"logout",on:{click:e.logout}},[i("i",{staticClass:"icon-exit"}),e._v("\n      退出登录\n    ")])])])},c=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"menu"},[i("div",[e._v("网盘")]),i("div",[e._v("分享")]),i("div",[e._v("其他资源")]),i("div",[e._v("更多")])])}],l=(i("a481"),i("87e7")),r={name:"TopBar",methods:{logout:function(){var e=this;l["a"].logout().then(function(t){t.data.status&&(e.$store.commit("setUserInfo",{}),e.$router.replace("./login"))})}}},o=r,u=(i("d23f"),i("2877")),d=Object(u["a"])(o,a,c,!1,null,"707581e6",null),f=d.exports,h=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"left"},[e._l(e.fileListType,function(t,s){return i("div",{staticClass:"type",class:{curr:e.$store.state.fileListType.id===t.id},on:{click:function(i){return e.setFileListType(t)}}},[e._v("\n    "+e._s(t.name)+"\n  ")])}),i("div",{staticClass:"size"},[i("span",[e._v("云盘空间：")]),i("div",{staticClass:"total"},[i("div",{staticClass:"current",style:{width:e.size.percent}},[i("div",{staticClass:"linear"})])]),i("div",{staticClass:"number"},[e._v("\n      "+e._s(e.size.curSize)+"/"+e._s(e.size.total)+"\n    ")])])],2)},p=[],v=(i("c5f6"),{name:"LeftBar",props:{currIndex:Number},data:function(){return{fileListType:[{name:"全部文件",id:"all"},{name:"图片",id:"image"},{name:"视频",id:"video"},{name:"文档",id:"text"},{name:"音乐",id:"audio"}]}},methods:{setFileListType:function(e){this.$store.commit("setFileListType",e)},formatSize:function(e){var t=e/1e3;if(t>1){var i=t/1e3;return i>1?i.toFixed(1)+"M":t.toFixed(1)+"KB"}return t+"B"}},computed:{size:function(){var e=this.$store.state.userInfo.size,t=this.$store.state.userInfo.total;return{percent:(e/t*100).toFixed(1)+"%",curSize:this.formatSize(e),total:this.formatSize(t)}}}}),m=v,_=(i("084e"),Object(u["a"])(m,h,p,!1,null,"37a90f38",null)),C=_.exports,w=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"content"},[i("div",{staticClass:"tool"},[i("div",{staticStyle:{position:"relative"}},[i("i",{staticClass:"icon-upload"}),i("span",[e._v("上传文件")]),i("input",{staticClass:"uploader file",attrs:{type:"file",multiple:""},on:{change:function(t){return e.setUploadFiles(t)}}})]),i("div",{on:{click:e.setCreateDir}},[i("i",{staticClass:"icon-folder-plus"}),i("span",[e._v("新建文件夹")])]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.selectedFiles.length>0,expression:"selectedFiles.length>0"}],on:{click:e.downloadFile}},[i("i",{staticClass:"icon-download"}),i("span",[e._v("下载文件")]),i("a",{ref:"download",attrs:{href:""}})]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.selectedFiles.length>0,expression:"selectedFiles.length>0"}],on:{click:e.deleteFile}},[i("i",{staticClass:"icon-delete"}),i("span",[e._v("删除文件")])]),i("SearchBar",{staticClass:"search"})],1),i("div",{staticClass:"breadcrumb"},[i("span",{directives:[{name:"show",rawName:"v-show",value:e.dirPath.length>0,expression:"dirPath.length>0"}],staticClass:"dirpath",on:{click:e.levelBack}},[i("span",[e._v("返回上一级")]),e._v(" | \n    ")]),i("span",{staticClass:"dirpath"},[i("span",{on:{click:function(t){return e.setDirPath("")}}},[e._v(e._s(e.fileListType.name))])]),e._l(e.dirPath,function(t,s){return i("span",{staticClass:"dirpath level"},[i("span",{on:{click:function(t){return e.setDirPath(s+1)}}},[e._v(e._s(t))])])})],2),i("div",{staticClass:"title"},[i("span",{staticClass:"col1"},[i("i",{staticClass:"checkbox",class:[e.allSelected?"icon-checkbox-checked":"icon-checkbox-unchecked"],on:{click:function(t){return e.selectAll()}}}),e._v("\n         \n        "),i("span",{staticClass:"sort",on:{click:function(t){return e.sortFile("name")}}},[e._v("文件名")])]),i("span",{staticClass:"col2 sort",on:{click:function(t){return e.sortFile("size")}}},[e._v("大小")]),i("span",{staticClass:"col3 sort",on:{click:function(t){return e.sortFile("time")}}},[e._v("修改时间")])]),i("div",{ref:"list_wrapper",staticClass:"wrapper"},[i("div",{staticClass:"lists"},[this.fileList.length<1&&e.noFile&&!e.isCreateDir?i("div",{staticClass:"no-content"},[e._v("当前文件列表为空")]):e._e(),e.isCreateDir?i("div",{staticClass:"list dirname"},[i("i",{staticClass:"checkbox icon-checkbox-unchecked"}),e._v("\n         \n        "),i("i",{staticClass:"fileType icon-file-folder"}),i("input",{directives:[{name:"model",rawName:"v-model",value:e.dirname,expression:"dirname"}],ref:"dirInput",attrs:{type:"text"},domProps:{value:e.dirname},on:{input:function(t){t.target.composing||(e.dirname=t.target.value)}}}),i("i",{staticClass:"icon-cross",on:{click:e.cancelCreateDir}}),e._v("\n         \n        "),i("i",{staticClass:"icon-checkmark",on:{click:e.createDir}})]):e._e(),e._l(e.fileList,function(t,s){return i("div",{staticClass:"list"},[i("span",{staticClass:"col1"},[i("i",{staticClass:"checkbox",class:[t.hasSelected?"icon-checkbox-checked":"icon-checkbox-unchecked"],on:{click:function(t){return e.setSelect(s)}}}),e._v("\n           \n        "),i("i",{staticClass:"fileType",class:"icon-file-"+e.classify(t)}),i("span",{staticClass:"name",attrs:{title:t.name},on:{click:function(i){return e.openFile(t)}}},[e._v(" "+e._s(t.name))])]),i("span",{staticClass:"col2"},[e._v(e._s("folder"===t.type?"-":e.formatSize(t.size)))]),i("span",{staticClass:"col3"},[e._v(e._s(t.create_time))])])})],2)]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showUploadList,expression:"showUploadList"}],staticClass:"uploadlist",class:{down:e.slideDown}},[i("div",{staticClass:"header"},[e._v("上传文件列表\n      "),i("span",{staticClass:"close icon-cancel-circle",on:{click:function(t){e.showUploadList=!1}}}),i("span",{staticClass:"close",class:[e.slideDown?"icon-circle-up":"icon-circle-down"],on:{click:function(t){e.slideDown=!e.slideDown}}})]),e._m(0),i("div",{staticClass:"wrapper"},[i("ul",e._l(e.uploadFileList,function(t,s){return i("li",{staticClass:"filelist"},[i("span",[e._v(e._s(t.name))]),i("span",[e._v(e._s(e.formatSize(t.file.size)))]),i("span",[i("i",{staticClass:"progress",style:{width:t.uploadStatus+"%"}}),i("i",[e._v("\n          "+e._s(t.status)+" "+e._s("上传中"===t.status?t.uploadStatus+"%":"")+"\n          ")])])])}),0)])]),i("transition",{attrs:{name:"tip"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.showTip,expression:"showTip"}],staticClass:"tip"},[e._v("\n      "+e._s(e.tip)+"\n    ")])])],1)},F=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"head filelist"},[i("span",[e._v("文件名")]),i("span",[e._v("大小")]),i("span",[e._v("上传状态")])])}],y=(i("d25f"),i("cebc")),x=(i("6d67"),i("28a5"),i("ac6a"),i("f3e2"),i("55dd"),i("7f7f"),i("7514"),i("cadf"),i("551c"),i("f751"),i("097d"),i("2f62")),g=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"searchbar"},[i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.filename,expression:"filename"}],attrs:{type:"text"},domProps:{value:e.filename},on:{input:function(t){t.target.composing||(e.filename=t.target.value)}}}),i("button",{on:{click:e.search}},[e._v("搜索")])])])},L=[],k={name:"SearchBar",data:function(){return{filename:""}},methods:{search:function(){this.$store.commit("setFileListType",{name:"搜索结果",id:"search",filename:this.filename})}}},b=k,D=(i("92df"),Object(u["a"])(b,g,L,!1,null,"51388c30",null)),S=D.exports,T={name:"Content",components:{SearchBar:S},data:function(){return{noFile:!1,fileList:[],dirname:"新建文件夹",isCreateDir:!1,allSelected:!1,uploadFileList:[],showUploadList:!1,slideDown:!1,downloadSrc:"",downloadName:"",sortType:"",tip:"",showTip:!1}},methods:{getFileList:function(){var e=this;l["a"].getFileList(this.fileListType,this.currentDir).then(function(t){t.data.status?(e.fileList=t.data.data,e.fileList.length<1&&(e.noFile=!0),e.sortFile("")):e.$router.replace("/login")})},formatSize:function(e){var t=e/1e3;if(t>1){var i=t/1e3;return i>1?i.toFixed(1)+"M":t.toFixed(1)+"KB"}return t+"B"},classify:function(e){if("folder"===e.type)return e.type;var t=[{type:"music",extend:/audio/},{type:"picture",extend:/image/},{type:"text",extend:/text/},{type:"video",extend:/video/},{type:"zip",extend:/gzip|tar|zip/},{type:"excel",extend:/excel|sheet/},{type:"word",extend:/msword|document/},{type:"pdf",extend:/pdf/}],i=t.find(function(t){return t.extend.test(e.type)});return i&&i.type||"other"},sortFile:function(e){var t=null;if(this.sortType===e&&e)return this.fileList.reverse();t="size"===e?function(e,t){return e.size-t.size}:"time"===e?function(e,t){return e.create_time.localeCompare(t.create_time)}:function(e,t){return"folder"===e.type&&"folder"!==t.type?-1:"folder"!==e.type&&"folder"===t.type?1:e.name.localeCompare(t.name)},this.fileList.sort(t),this.sortType=e},setSelect:function(e){this.allSelected=!1;var t=this.fileList[e];this.$set(t,"hasSelected",!t.hasSelected)},selectAll:function(){var e=this;this.allSelected=!this.allSelected,this.fileList.forEach(function(t){e.$set(t,"hasSelected",e.allSelected)})},setUploadFiles:function(e){this.slideDown=!1,this.showUploadList=!0;for(var t=e.target.files,i=0,s=0;s<t.length;s++){if(i+=t[s].size,this.userInfo.size+i>=this.userInfo.total)return alert("已超出网盘空间限制！"),void(e.target.files=[]);var n={file:t[s],status:"未上传",uploadStatus:0};this.uploadFileList.unshift(n),this.uploadFiles(n)}e.target.value=""},uploadFiles:function(e){var t=this;if(e.name=e.file.name,e.file.size>2e8)e.status="文件过大 ";else{e.status="上传中 ";var i=0;while(this.fileList.find(function(t){return e.name===t.name})){if(i++,i>100)return;if(/\(\d*\)./.test(e.name))e.name=e.name.replace(/\(\d*\)/,"("+i+")");else{var s=e.name.split(".").reverse();s[1]+="(1)",e.name=s.reverse().join(".")}}l["a"].uploadFile(e.file,e.name,this.currentDir,function(t){var i=t.loaded/t.total*100;e.uploadStatus=i.toFixed(1)}).then(function(i){t.$store.commit("setUserInfo",i.data),e.status="完成",t.getFileList()}).catch(function(t){e.status="未完成"})}},deleteFile:function(){var e=this;if(confirm("确定要删除"+this.selectedFiles.length+"项?")){this.allSelected=!1;var t=this.selectedFiles.map(function(e){return{name:e.name,path:e.path}});l["a"].deleteFile(t).then(function(t){e.$store.commit("setUserInfo",t.data),e.getFileList()})}},setCreateDir:function(){var e=this;this.isCreateDir=!0,this.$nextTick(function(){e.$refs.dirInput.focus(),e.$refs.dirInput.select()})},createDir:function(){var e=this;l["a"].createDir(this.currentDir,this.dirname).then(function(t){e.cancelCreateDir(),e.getFileList()})},cancelCreateDir:function(){this.isCreateDir=!1,this.dirname="新建文件夹"},downloadFile:function(){var e=this,t=this.selectedFiles;t.length>1&&!confirm("确定要下载多个文件?")||t.forEach(function(t){if("folder"!==t.type){var i=document.createElement("a");i.style.display="none",i.style.height=0,i.download=t.name,i.href=l["a"].getFileUrl(e.currentDir+t.name),document.body.appendChild(i),i.click(),setTimeout(function(){i.remove()},5e3)}else e.showToast("暂不支持文件夹下载")})},openFile:function(e){var t=this.currentDir+e.name;switch(this.classify(e)){case"picture":case"music":case"text":case"video":case"pdf":window.open(l["a"].getFileUrl(t));break;case"folder":this.$store.commit("setCurrentDir",t),this.getFileList();break;default:console.log("other")}},setDirPath:function(e){var t="";e&&(t=this.dirPath.slice(0,e).join("/")),this.$store.commit("setCurrentDir",t),this.getFileList()},levelBack:function(){var e=this.dirPath.slice(0,-1).join("/");this.$store.commit("setCurrentDir",e),this.getFileList()},showToast:function(e){var t=this;clearTimeout(this.timer),this.tip=e,this.showTip=!0,this.timer=setTimeout(function(){t.showTip=!1},1e3)}},computed:Object(y["a"])({selectedFiles:function(){return this.fileList.filter(function(e){return e.hasSelected})},dirPath:function(){var e=this.currentDir.split("/");return e.splice(-1,1),e}},Object(x["b"])(["currentDir","fileListType","userInfo"])),watch:{fileListType:function(){this.getFileList(),this.$store.commit("setCurrentDir","")}},created:function(){this.getFileList()}},$=T,z=(i("d6bb"),Object(u["a"])($,w,F,!1,null,"48dcfccc",null)),B=z.exports,I={name:"home",components:{TopBar:f,LeftBar:C,Content:B},methods:{}},U=I,P=(i("c219"),Object(u["a"])(U,s,n,!1,null,null,null));t["default"]=P.exports},c219:function(e,t,i){"use strict";var s=i("e9bb"),n=i.n(s);n.a},d23f:function(e,t,i){"use strict";var s=i("02c1"),n=i.n(s);n.a},d6bb:function(e,t,i){"use strict";var s=i("63e9"),n=i.n(s);n.a},e9bb:function(e,t,i){}}]);